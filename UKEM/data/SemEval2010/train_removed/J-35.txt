efficiency and nash equilibria in a scrip system for p p 
networks 
eric j friedman 
school of operations 
research and industrial 
engineering 
cornell university 
ejf  cornell edu 
joseph y halpern 
computer science dept 
cornell university 
halpern cs cornell edu 
ian kash 
computer science dept 
cornell university 
kash cs cornell edu 
abstract 
a model of providing service in a p p network is analyzed 
it is shown that by adding a scrip system a mechanism that 
admits a reasonable nash equilibrium that reduces free 
riding can be obtained the effect of varying the total amount 
of money scrip in the system on efficiency i e social 
welfare is analyzed and it is shown that by maintaining the 
appropriate ratio between the total amount of money and 
the number of agents efficiency is maximized the work 
has implications for many online systems not only p p 
networks but also a wide variety of online forums for which scrip 
systems are popular but formal analyses have been lacking 
categories and subject descriptors 
c computer-communication networks distributed 
systems i artificial intelligence distributed 
artificial intelligence-multiagent systems j social and 
behavioral sciences economics k computers and 
society electronic commerce 
general terms 
economics theory 
 introduction 
a common feature of many online distributed systems is 
that individuals provide services for each other 
peer-topeer p p networks such as kazaa or bittorrent 
have proved popular as mechanisms for file sharing and 
applications such as distributed computation and file storage 
are on the horizon systems such as seti home provide 
computational assistance systems such as slashdot 
provide content evaluations and advice forums in which people 
answer each other s questions having individuals provide 
each other with service typically increases the social welfare 
the individual utilizing the resources of the system derives a 
greater benefit from it than the cost to the individual 
providing it however the cost of providing service can still be 
nontrivial for example users of kazaa and bittorrent may 
be charged for bandwidth usage in addition in some 
filesharing systems there is the possibility of being sued which 
can be viewed as part of the cost thus in many systems 
there is a strong incentive to become a free rider and 
benefit from the system without contributing to it this is not 
merely a theoretical problem studies of the gnutella 
network have shown that almost percent of users share 
no files and nearly percent of responses are from the top 
 percent of sharing hosts 
having relatively few users provide most of the service 
creates a point of centralization the disappearance of a small 
percentage of users can greatly impair the functionality of 
the system moreover current trends seem to be leading 
to the elimination of the altruistic users on which these 
systems rely these heavy users are some of the most 
expensive customers isps have thus as the amount of traffic has 
grown isps have begun to seek ways to reduce this traffic 
some universities have started charging students for 
excessive bandwidth usage others revoke network access for it 
 a number of companies have also formed whose service 
is to detect excessive bandwidth usage 
these trends make developing a system that encourages 
a more equal distribution of the work critical for the 
continued viability of p p networks and other distributed online 
systems a significant amount of research has gone into 
designing reputation systems to give preferential treatment 
to users who are sharing files some of the p p networks 
currently in use have implemented versions of these 
techniques however these approaches tend to fall into one of 
two categories either they are barter-like or reputational 
by barter-like we mean that each agent bases its decisions 
only on information it has derived from its own interactions 
perhaps the best-known example of a barter-like system is 
bittorrent where clients downloading a file try to find other 
clients with parts they are missing so that they can trade 
thus creating a roughly equal amount of work since the 
barter is restricted to users currently interested in a 
single file this works well for popular files but tends to have 
problems maintaining availability of less popular ones an 
example of a barter-like system built on top of a more 
traditional file-sharing system is the credit system used by emule 
 
 each user tracks his history of interactions with other 
users and gives priority to those he has downloaded from in 
the past however in a large system the probability that 
a pair of randomly-chosen users will have interacted before 
is quite small so this interaction history will not be 
terribly helpful anagnostakis and greenwald present a more 
sophisticated version of this approach but it still seems to 
suffer from similar problems 
a number of attempts have been made at providing 
general reputation systems e g the basic idea 
is to aggregate each user s experience into a global number 
for each individual that intuitively represents the system s 
view of that individual s reputation however these 
attempts tend to suffer from practical problems because they 
implicitly view users as either good or bad assume that 
the good users will act according to the specified protocol 
and that there are relatively few bad users unfortunately 
if there are easy ways to game the system once this 
information becomes widely available rational users are likely to 
make use of it we cannot count on only a few users being 
bad in the sense of not following the prescribed protocol 
for example kazaa uses a measure of the ratio of the 
number of uploads to the number of downloads to identify good 
and bad users however to avoid penalizing new users they 
gave new users an average rating users discovered that they 
could use this relatively good rating to free ride for a while 
and once it started to get bad they could delete their stored 
information and effectively come back as a new user thus 
circumventing the system see for a discussion and 
for a formal analysis of this whitewashing thus kazaa s 
reputation system is ineffective 
this is a simple case of a more general vulnerability of 
such systems to sybil attacks where a single user 
maintains multiple identities and uses them in a coordinated 
fashion to get better service than he otherwise would recent 
work has shown that most common reputation systems are 
vulnerable in the worst case to such attacks however 
the degree of this vulnerability is still unclear the 
analyses of the practical vulnerabilities and the existence of such 
systems that are immune to such attacks remains an area of 
active research e g 
simple economic systems based on a scrip or money seem 
to avoid many of these problems are easy to implement and 
are quite popular see e g however they 
have a different set of problems perhaps the most common 
involve determining the amount of money in the system 
roughly speaking if there is too little money in the system 
relative to the number of agents then relatively few users 
can afford to make request on the other hand if there is 
too much money then users will not feel the need to 
respond to a request they have enough money already a 
related problem involves handling newcomers if newcomers 
are each given a positive amount of money then the system 
is open to sybil attacks perhaps not surprisingly scrip 
systems end up having to deal with standard economic woes 
such as inflation bubbles and crashes 
in this paper we provide a formal model in which to 
analyze scrip systems we describe a simple scrip system 
and show that under reasonable assumptions for each fixed 
amount of money there is a nontrivial nash equilibrium 
involving threshold strategies where an agent accepts a request 
if he has less than k for some threshold k 
an interesting 
aspect of our analysis is that in equilibrium the 
distribution of users with each amount of money is the distribution 
that maximizes entropy subject to the money supply 
constraint this allows us to compute the money supply that 
maximizes efficiency social welfare given the number of 
agents it also leads to a solution for the problem of 
dealing with newcomers we simply assume that new users come 
in with no money and adjust the price of service which is 
equivalent to adjusting the money supply to maintain the 
ratio that maximizes efficiency while assuming that new 
users come in with no money will not work in all settings 
we believe the approach will be widely applicable in 
systems where the goal is to do work new users can acquire 
money by performing work it should also work in 
kazaalike system where a user can come in with some resources 
 e g a private collection of mp s 
the rest of the paper is organized as follows in section 
we present our formal model and observe that it can be used 
to understand the effect of altruists in section we 
examine what happens in the game under nonstrategic play if all 
agents use the same threshold strategy we show that in 
this case the system quickly converges to a situation where 
the distribution of money is characterized by maximum 
entropy using this analysis we show in section that under 
minimal assumptions there is a nontrivial nash equilibrium 
in the game where all agents use some threshold strategy 
moreover we show in section that the analysis leads to 
an understanding of how to choose the amount of money 
in the system or equivalently the cost to fulfill a request 
so as to maximize efficiency and also shows how to handle 
new users in section we discuss the extent to which our 
approach can handle sybils and collusion we conclude in 
section 
 the model 
to begin we formalize providing service in a p p network 
as a non-cooperative game unlike much of the modeling in 
this area our model will model the asymmetric interactions 
in a file sharing system in which the matching of players 
 those requesting a file with those who have that particular 
file is a key part of the system this is in contrast with 
much previous work which uses random matching in a 
prisoner s dilemma such models were studied in the economics 
literature and first applied to online reputations in 
 an application to p p is found in 
this random-matching model fails to capture some salient 
aspects of a number of important settings when a request 
is made there are typically many people in the network who 
can potentially satisfy it especially in a large p p network 
but not all can for example some people may not have 
the time or resources to satisfy the request the 
randommatching process ignores the fact that some people may not 
be able to satisfy the request presumably if the person 
matched with the requester could not satisfy the match he 
would have to defect moreover it does not capture the fact 
that the decision as to whether to volunteer to satisfy 
the request should be made before the matching process 
not after that is the matching process does not capture 
 
although we refer to our unit of scrip as the dollar these 
are not real dollars nor do we view them as convertible to 
dollars 
 
the fact that if someone is unwilling to satisfy the request 
there will doubtless be others who can satisfy it finally the 
actions and payoffs in the prisoner s dilemma game do not 
obviously correspond to actual choices that can be made 
for example it is not clear what defection on the part of 
the requester means in our model we try to deal with all 
these issues 
suppose that there are n agents at each round an agent 
is picked uniformly at random to make a request each other 
agent is able to satisfy this request with probability β at 
all times independent of previous behavior the term β is 
intended to capture the probability that an agent is busy or 
does not have the resources to fulfill the request assuming 
that β is time-independent does not capture the intution 
that being an unable to fulfill a request at time t may well 
be correlated with being unable to fulfill it at time t we 
believe that in large systems we should be able to drop the 
independence assumption but we leave this for future work 
in any case those agents that are able to satisfy the request 
must choose whether or not to volunteer to satisfy it if 
at least one agent volunteers the requester gets a benefit 
of util the job is done and one of volunteers is chosen 
at random to fulfill the request the agent that fulfills the 
request pays a cost of α as is standard in the literature 
we assume that agents discount future payoffs by a factor of 
δ per time unit this captures the intuition that a util now is 
worth more than a util tomorrow and allows us to compute 
the total utility derived by an agent in an infinite game 
lastly we assume that with more players requests come 
more often thus we assume that the time between rounds 
is n this captures the fact that the systems we want 
to model are really processing many requests in parallel so 
we would expect the number of concurrent requests to be 
proportional to the number of users 
let g n δ α β denote this game with n agents a 
discount factor of δ a cost to satisfy requests of α and a 
probability of being able to satisfy requests of β when the 
latter two parameters are not relevant we sometimes write 
g n δ 
we use the following notation throughout the paper 
 pt 
denotes the agent chosen in round t 
 bt 
i ∈ denotes whether agent i can satisfy the 
request in round t bt 
i with probability β and 
bt 
i is independent of bt 
i for all t t 
 v t 
i ∈ denotes agent i s decision about whether 
to volunteer in round t indicates volunteering v t 
i 
is determined by agent i s strategy 
 vt 
∈ j v t 
j bt 
j denotes the agent chosen to satisfy 
the request this agent is chosen uniformly at random 
from those who are willing v t 
j and able bt 
j 
to satisfy the request 
 ut 
i denotes agent i s utility in round t 
a standard agent is one whose utility is determined as 
discussed in the introduction namely the agent gets 
 
for large n our model converges to one in which players 
make requests in real time and the time between a player s 
requests are exponentially distributed with mean in 
addition the time between requests served by a single player 
is also exponentially distributed 
a utility of for a fulfilled request and utility −α for 
fulfilling a request thus if i is a standard agent then 
ut 
i 
 
 
 
 if i pt and 
p 
j i v t 
j bt 
j 
−α if i vt 
 otherwise 
 ui 
p∞ 
t δt n 
ut 
i denotes the total utility for agent 
i it is the discounted total of agent i s utility in each 
round note that the effective discount factor is δ n 
since an increase in n leads to a shortening of the time 
between rounds 
now that we have a model of making and satisfying 
requests we use it to analyze free riding take an altruist to 
be someone who always fulfills requests agent i might 
rationally behave altruistically if agent i s utility function has 
the following form for some α 
ut 
i 
 
 
 
 if i pt and 
p 
j i v t 
j bt 
j 
α if i vt 
 otherwise 
thus rather than suffering a loss of utility when satisfying 
a request an agent derives positive utility from satisfying 
it such a utility function is a reasonable representation of 
the pleasure that some people get from the sense that they 
provide the music that everyone is playing for such 
altruistic agents playing the strategy that sets v t 
i for all t 
is dominant while having a nonstandard utility function 
might be one reason that a rational agent might use this 
strategy there are certainly others for example a naive 
user of filesharing software with a good connection might 
well follow this strategy all that matters for the 
following discussion is that there are some agents that use this 
strategy for whatever reason 
as we have observed such users seem to exist in some 
large systems suppose that our system has a altruists 
intuitively if a is moderately large they will manage to satisfy 
most of the requests in the system even if other agents do 
no work thus there is little incentive for any other agent 
to volunteer because he is already getting full advantage of 
participating in the system based on this intuition it is a 
relatively straightforward calculation to determine a value 
of a that depends only on α β and δ but not the number 
n of players in the system such that the dominant strategy 
for all standard agents i is to never volunteer to satisfy any 
requests i e v t 
i for all t 
proposition there exists an a that depends only on 
α β and δ such that in g n δ α β with at least a altruists 
not volunteering in every round is a dominant strategy for 
all standard agents 
proof consider the strategy for a standard player j in 
the presence of a altruists even with no money player 
j will get a request satisfied with probability − − β a 
just through the actions of these altruists thus even if j is 
chosen to make a request in every round the most additional 
expected utility he can hope to gain by having money isp∞ 
k − β a 
δk 
 − β a 
 − δ if − β a 
 − δ α 
or equivalently if a log −β α − δ never volunteering 
is a dominant strategy 
consider the following reasonable values for our 
parameters β so that each player can satisfy of the 
requests α a low but non-negligible cost δ day 
 
 which corresponds to a yearly discount factor of 
approximately and an average of request per day per player 
then we only need a while this is a large number 
it is small relative to the size of a large p p network 
current systems all have a pool of users behaving like our 
altruists this means that attempts to add a reputation 
system on top of an existing p p system to influence users 
to cooperate will have no effect on rational users to have 
a fair distribution of work these systems must be 
fundamentally redesigned to eliminate the pool of altruistic users 
in some sense this is not a problem at all in a system 
with altruists the altruists are presumably happy as are 
the standard agents who get almost all their requests 
satisfied without having to do any work indeed current p p 
network work quite well in terms of distributing content to 
people however as we said in the introduction there is 
some reason to believe these altruists may not be around 
forever thus it is worth looking at what can be done to 
make these systems work in their absence for the rest of 
this paper we assume that all agents are standard and try 
to maximize expected utility 
we are interested in equilibria based on a scrip system 
each time an agent has a request satisfied he must pay the 
person who satisfied it some amount for now we assume 
that the payment is fixed for simplicity we take the amount 
to be we denote by m the total amount of money in 
the system we assume that m otherwise no one will 
ever be able to get paid 
in principle agents are free to adopt a very wide 
variety of strategies they can make decisions based on the 
names of other agents or use a strategy that is heavily 
history dependant and mix these strategies freely to aid our 
analysis we would like to be able to restrict our attention to 
a simpler class of strategies the class of strategies we are 
interested in is easy to motivate the intuitive reason for 
wanting to earn money is to cater for the possibility that an 
agent will run out before he has a chance to earn more on 
the other hand a rational agent with plenty of mone would 
not want to work because by the time he has managed to 
spend all his money the util will have less value than the 
present cost of working the natural balance between these 
two is a threshold strategy let sk be the strategy where 
an agent volunteers whenever he has less than k dollars and 
not otherwise note that s is the strategy where the agent 
never volunteers while everyone playing s is a nash 
equilibrium nobody can do better by volunteering if no one else 
is willing to it is an uninteresting one as we will show 
in section it is sufficient to restrict our attention to this 
class of strategies 
we use kt 
i to denote the amount of money agent i has 
at time t clearly kt 
i kt 
i unless agent i has a request 
satisfied in which case kt 
i kt 
i − or agent i fulfills a 
request in which case kt 
i kt 
i formally 
kt 
i 
 
 
 
kt 
i − if i pt 
 
p 
j i v t 
j bt 
j and kt 
i 
kt 
i if i vt 
and kt 
pt 
kt 
i otherwise 
the threshold strategy sk is the strategy such that 
v t 
i 
 
 if kt 
pt and kt 
i k 
 otherwise 
 the game under nonstrategic 
play 
before we consider strategic play we examine what 
happens in the system if everyone just plays the same strategy 
sk our overall goal is to show that there is some 
distribution over money i e the fraction of people with each 
amount of money such that the system converges to this 
distribution in a sense to be made precise shortly 
suppose that everyone plays sk for simplicity assume 
that everyone has at most k dollars we can make this 
assumption with essentially no loss of generality since if 
someone has more than k dollars he will just spend money 
until he has at most k dollars after this point he will never 
acquire more than k thus eventually the system will be 
in such a state if m ≥ kn no agent will ever be willing to 
work thus for the purposes of this section we assume that 
m kn 
from the perspective of a single agent in stochastic 
equilibrium the agent is undergoing a random walk 
however the parameters of this random walk depend on the 
random walks of the other agents and it is quite complicated 
to solve directly thus we consider an alternative analysis 
based on the evolution of the system as a whole 
if everyone has at most k dollars then the amount of 
money that an agent has is an element of k if there 
are n agents then the state of the game can be described 
by identifying how much money each agent has so we can 
represent it by an element of sk n k n 
 since 
the total amount of money is constant not all of these states 
can arise in the game for example the state where each 
player has is impossible to reach in any game with money 
in the system let ms s 
p 
i∈ n s i denote the total 
mount of money in the game at state s where s i is the 
number of dollars that agent i has in state s we want 
to consider only those states where the total money in the 
system is m namely 
sk n m s ∈ sk n ms s m 
under the assumption that all agents use strategy sk the 
evolution of the system can be treated as a markov chain 
mk n m over the state space sk n m it is possible to move 
from one state to another in a single round if by choosing 
a particular agent to make a request and a particular agent 
to satisfy it the amounts of money possesed by each agent 
become those in the second state therefore the 
probability of a transition from a state s to t is unless there exist 
two agents i and j such that s i t i for all i ∈ i j 
t i s i and t j s j − in this case the 
probability of transitioning from s to t is the probability of j 
being chosen to spend a dollar and has someone willing and 
able to satisfy his request n − − β i s i k −ij 
 
multiplied by the probability of i being chosen to satisfy his 
request i s i k − ij ij is if j has k dollars 
and otherwise it is just a correction for the fact that j 
cannot satisfy his own request 
let ∆k 
denote the set of probability distributions on k 
we can think of an element of ∆k 
as describing the fraction 
of people with each amount of money this is a useful way 
of looking at the system since we typically don t care who 
has each amount of money but just the fraction of people 
that have each amount as before not all elements of ∆k 
are possible given our constraint that the total amount of 
 
money is m rather than thinking in terms of the total 
amount of money in the system it will prove more useful to 
think in terms of the average amount of money each player 
has of course the total amount of money in a system 
with n agents is m iff the average amount that each player 
has is m m n let ∆k 
m denote all distributions d ∈ ∆k 
such that e d m i e 
pk 
j d j j m given a state 
s ∈ sk n m let ds 
∈ ∆k 
m denote the distribution of money 
in s our goal is to show that if n is large then there is 
a distribution d 
∈ ∆k 
m such that with high probability 
the markov chain mk n m will almost always be in a state 
s such that ds 
is close to d 
 thus agents can base their 
decisions about what strategy to use on the assumption that 
they will be in such a state 
we can in fact completely characterize the distribution 
d 
 given a distribution d ∈ ∆k 
 let 
h d − 
x 
 j d j 
d j log d j 
denote the entropy of d if ∆ is a closed convex set of 
distributions then it is well known that there is a unique 
distribution in ∆ at which the entropy function takes its maximum 
value in ∆ since ∆k 
m is easily seen to be a closed convex set 
of distributions it follows that there is a unique distribution 
in ∆k 
m that we denote d 
k m whose entropy is greater than 
that of all other distributions in ∆k 
m we now show that 
for n sufficiently large the markov chain mk n m is almost 
surely in a state s such that ds 
is close to d 
k m n the 
statement is correct under a number of senses of close 
for definiteness we consider the euclidean distance given 
 let sk n m denote the set of states s in sk n mn such 
that 
pk 
j ds 
 j − d 
k m 
 
given a markov chain m over a state space s and s ⊆ s 
let xt s s be the random variable that denotes that m is in 
a state of s at time t when started in state s 
theorem for all all k and all m there exists 
n such that for all n n and all states s ∈ sk n mn there 
exists a time t 
 which may depend on k n m and such 
that for t t 
 we have pr xt s sk n m − 
proof sketch suppose that at some time t pr xt s s 
is uniform for all s then the probability of being in a set of 
states is just the size of the set divided by the total number of 
states a standard technique from statistical mechanics is to 
show that there is a concentration phenomenon around the 
maximum entropy distribution more precisely using 
a straightforward combinatorial argument it can be shown 
that the fraction of states not in sk n m is bounded by 
p n ecn 
 where p is a polynomial this fraction clearly 
goes to as n gets large thus for sufficiently large n 
pr xt s sk n m − if pr xt s s is uniform 
it is relatively straightforward to show that our markov 
chain has a limit distribution π over sk n mn such that for 
all s s ∈ sk n mn limt→∞ pr xt s s πs let pij denote 
the probability of transitioning from state i to state j it 
is easily verified by an explicit computation of the 
transition probabilities that pij pji for all states i and j it 
immediatly follows from this symmetry that πs πs so 
π is uniform after a sufficient amount of time the 
distribution will be close enough to π that the probabilities are 
again bounded by constant which is sufficient to complete 
the theorem 
 
euclidean distance 
 
 
 
 
 
numberofsteps 
figure distance from maximum-entropy 
distribution with agents 
 
number of agents 
 
 
 
 
 
maximumdistance 
figure maximum distance from 
maximumentropy distribution over 
timesteps 
 
number of agents 
 
 
 
 
timetodistance 
figure average time to get within of the 
maximum-entropy distribution 
 
we performed a number of experiments that show that 
the maximum entropy behavior described in theorem 
arises quickly for quite practical values of n and t the 
first experiment showed that even if n we reach 
the maximum-entropy distribution quickly we averaged 
runs of the markov chain for k where there is enough 
money for each agent to have starting from a very extreme 
distribution every agent has either or and considered 
the average time needed to come within various distances 
of the maximum entropy distribution as figure shows 
after steps on average the euclidean distance from 
the average distribution of money to the maximum-entropy 
distribution is after steps the distance is down 
to note that this is really only real time units since 
with players we have transactions per time unit 
we then considered how close the distribution stays to 
the maximum entropy distribution once it has reached it 
to simplify things we started the system in a state whose 
distribution was very close to the maximum-entropy 
distribution and ran it for 
steps for various values of n 
as figure shows the system does not move far from the 
maximum-entropy distribution once it is there for 
example if n the system is never more than distance 
from the maximum-entropy distribution if n it is 
never more than from the maximum-entropy 
distribution 
finally we considered how more carefully how quickly 
the system converges to the maximum-entropy distribution 
for various values of n there are approximately kn 
 
possible states so the convergence time could in principle be 
quite large however we suspect that the markov chain 
that arises here is rapidly mixing which means that it will 
converge significantly faster see for more details about 
rapid mixing we believe that the actually time needed is 
o n this behavior is illustrated in figure which shows 
that for our example chain again averaged over runs 
after n steps the euclidean distance between the actual 
distribution of money in the system and the maximum-entropy 
distribution is less than 
 the game under strategic play 
we have seen that the system is well behaved if the agents 
all follow a threshold strategy we now want to show that 
there is a nontrivial nash equilibrium where they do so that 
is a nash equilibrium where all the agents use sk for some 
k this is not true in general if δ is small then agents 
have no incentive to work intuitively if future utility is 
sufficiently discounted then all that matters is the present 
and there is no point in volunteering to work with small 
δ s is the only equilibrium however we show that for δ 
sufficiently large there is another equilibrium in threshold 
strategies we do this by first showing that if every other 
agent is playing a threshold strategy then there is a best 
response that is also a threshold strategy although not 
necessarily the same one we then show that there must be 
some mixed threshold strategy for which this best response 
is the same strategy it follows that this tuple of threshold 
strategies is a nash equilibrium 
as a first step we show that for all k if everyone other 
than agent i is playing sk then there is a threshold 
strategy sk that is a best response for agent i to prove this 
we need to assume that the system is close to the 
steadystate distribution i e the maximum-entropy distribution 
however as long as δ is sufficiently close to we can ignore 
what happens during the period that the system is not in 
steady state 
we have thus far considered threshold strategies of the 
form sk where k is a natural number this is a discrete set 
of strategies for a later proof it will be helpful to have 
a continuous set of strategies if γ k γ where k is 
a natural number and ≤ γ let sγ be the strategy 
that performs sk with probability − γ and sk with 
probability γ note that we are not considering arbitrary 
mixed threshold strategies here but rather just mixing 
between adjacent strategies for the sole purpose of making out 
strategies continuous in a natural way theorem 
applies to strategies sγ the same proof goes through without 
change where γ is an arbitrary nonnegative real number 
theorem fix a strategy sγ and an agent i there 
exists δ 
 and n 
such that if δ δ 
 n n 
 and every 
agent other than i is playing sγ in game g n δ then there 
is an integer k such that the best response for agent i is sk 
either k is unique that is there is a unique best response 
that is also a threshold strategy or there exists an integer 
k such that sγ is a best response for agent i for all γ in 
the interval k k and these are the only best responses 
among threshold strategies 
proof sketch if δ is sufficiently large we can ignore 
what happens before the system converges to the 
maximumentropy distribution if n is sufficiently large then the 
strategy played by one agent will not affect the distribution of 
money significantly thus the probability of i moving from 
one state dollar amount to another depends only on i s 
strategy since we can take the probability that i will be 
chosen to make a request and the probability that i will 
be chosen to satisfy a request to be constant thus from 
i s point of view the system is a markov decision process 
 mdp and i needs to compute the optimal policy 
 strategy for this mdp it follows from standard results 
theorem that there is an optimal policy that is a 
threshold policy 
the argument that the best response is either unique or 
there is an interval of best responses follows from a more 
careful analysis of the value function for the mdp 
we remark that there may be best responses that are not 
threshold strategies all that theorem shows is that 
among best responses there is at least one that is a threshold 
strategy since we know that there is a best response that 
is a threshold strategy we can look for a nash equilibrium 
in the space of threshold strategies 
theorem for all m there exists δ 
 and n 
such 
that if δ δ 
and n n 
 there exists a nash equilibrium in 
the game g n δ where all agents play sγ for some integer 
γ 
proof it follows easily from the proof theorem that 
if br δ γ is the minimal best response threshold strategy if 
all the other agents are playing sγ and the discount factor is 
δ then for fixed δ br δ · is a step function it also follows 
 
formally we need to define the strategies when the system 
is far from equilibrium however these far from stochastic 
equilibrium strategies will not affect the equilibrium 
behavior when n is large and deviations from stochastic 
equilibrium are extremely rare 
 
from the theorem that if there are two best responses then 
a mixture of them is also a best response therefore if we 
can join the steps by a vertical line we get a best-response 
curve it is easy to see that everywhere that this 
bestresponse curve crosses the diagonal y x defines a nash 
equilibrium where all agents are using the same threshold 
strategy as we have already observed one such 
equilibrium occurs at if there are only m in the system we can 
restrict to threshold strategies sk where k ≤ m since 
no one can have more than m all strategies sk for k m 
are equivalent to sm these are just the strategies where 
the agent always volunteers in response to request made by 
someone who can pay clearly br δ sm ≤ m for all δ so 
the best response function is at or below the equilibrium at 
m if k ≤ m n every player will have at least k dollars 
and so will be unwilling to work and the best response is 
just consider k 
 the smallest k such that k m n it 
is not hard to show that for k 
there exists a δ 
such that 
for all δ ≥ δ 
 br δ k 
 ≥ k 
 it follows by continuity that if 
δ ≥ δ 
 there must be some γ such that br δ γ γ this 
is the desired nash equilibrium 
this argument also shows us that we cannot in general 
expect fixed points to be unique if br δ k 
 k 
and 
br δ k k then our argument shows there must be 
a second fixed point in general there may be multiple fixed 
points even when br δ k 
 k 
 as illustrated in the figure 
 with n and m 
 
strategy of rest of agents 
 
 
 
 
 
 
bestresponse 
figure the best response function for n 
and m 
theorem allows us to restrict our design to agents 
using threshold strategies with the confidence that there will 
be a nontrivial equilibrium however it does not rule out 
the possibility that there may be other equilibria that do 
not involve threshold stratgies it is even possible although 
it seems unlikely that some of these equilibria might be 
better 
 social welfare and scalabity 
our theorems show that for each value of m and n for 
sufficiently large δ there is a nontrivial nash equilibrium 
where all the agents use some threshold strategy sγ m n 
from the point of view of the system designer not all 
equilibria are equally good we want an equilibrium where as few 
as possible agents have when they get a chance to make a 
request so that they can pay for the request and relatively 
few agents have more than the threshold amount of money 
 so that there are always plenty of agents to fulfill the 
request there is a tension between these objectives it is not 
hard to show that as the fraction of agents with increases 
in the maximum entropy distribution the fraction of agents 
with the maximum amount of money decreases thus our 
goal is to understand what the optimal amount of money 
should be in the system given the number of agents that 
is we want to know the amount of money m that maximizes 
efficiency i e the total expected utility if all the agents use 
sγ m n 
we first observe that the most efficient equilibrium 
depends only on the ratio of m to n not on the actual values 
of m and n 
theorem there exists n 
such that for all games 
g n δ and g n δ where n n n 
 if m n m n 
then sγ m n sγ m n 
proof fix m n r theorem shows that the 
maximum-entropy distribution depends only on k and the 
ratio m n not on m and n separately thus given r for 
each choice of k there is a unique maximum entropy 
distribution dk r the best response br δ k depends only on the 
distribution dk r not m or n thus the nash equilibrium 
depends only on the ratio r that is for all choices of m 
and n such that n is sufficiently large so that theorem 
applies and m n r the equilibrium strategies are the 
same 
in light of theorem the system designer should ensure 
that there is enough money m in the system so that the 
ratio between m n is optimal we are currently exploring 
exactly what the optimal ratio is as our very preliminary 
results for β show in figure the ratio appears to be 
monotone increasing in δ which matches the intuition that 
we should provide more patient agents with the opportunity 
to save more money additionally it appears to be relatively 
smooth which suggests that it may have a nice analytic 
solution 
 
discount rate ∆ 
 
 
 
 
 
optimalratioofmn 
figure optimal average amount of money to the 
nearest for β 
we remark that in practice it may be easier for the 
designer to vary the price of fulfilling a request rather than 
 
if there are multiple equilibria we take sγ m n to be the 
nash equilibrium that has highest efficiency for fixed m and 
n 
 
injecting money in the system this produces the same 
effect for example changing the cost of fulfilling a request 
from to is equivalent to halving the amount of money 
that each agent has similarly halving the the cost of 
fulfilling a request is equivalent to doubling the amount of money 
that everyone has with a fixed amount of money m there 
is an optimal product nc of the number of agents and the 
cost c of fulfilling a request 
theorem also tells us how to deal with a dynamic pool 
of agents our system can handle newcomers relatively 
easily simply allow them to join with no money this gives 
existing agents no incentive to leave and rejoin as 
newcomers we then change the price of fulfilling a request so that 
the optimal ratio is maintained this method has the nice 
feature that it can be implemented in a distributed fashion 
if all nodes in the system have a good estimate of n then 
they can all adjust prices automatically alternatively the 
number of agents in the system can be posted in a 
public place approaches that rely on adjusting the amount 
of money may require expensive system-wide computations 
 see for an example and must be carefully tuned to 
avoid creating incentives for agents to manipulate the 
system by which this is done 
note that in principle the realization that the cost of 
fulfilling a request can change can affect an agent s 
strategy for example if an agent expects the cost to increase 
then he may want to defer volunteering to fulfill a request 
however if the number of agents in the system is always 
increasing then the cost always decreases so there is never 
any advantage in waiting 
there may be an advantage in delaying a request but it 
is far more costly in terms of waiting costs than in 
providing service since we assume the need for a service is often 
subject to real waiting costs while the need to supply the 
service is merely to augment a money supply related 
issues are discussed in 
we ultimately hope to modify the mechanism so that the 
price of a job can be set endogenously within the system 
 as in real-world economies with agents bidding for jobs 
rather than there being a fixed cost set externally however 
we have not yet explored the changes required to implement 
this change thus for now we assume that the cost is set 
as a function of the number of agents in the system and 
that there is no possibility for agents to satisfy a request for 
less than the official cost or for requesters to offer to pay 
more than it 
 sybils and collusion 
in a naive sense our system is essentially sybil-proof to 
get d dollars his sybils together still have to perform d units 
of work moreover since newcomers enter the system with 
 there is no benefit to creating new agents simply to take 
advantage of an initial endowment nevertheless there are 
some less direct ways that an agent could take advantage 
of sybils first by having more identities he will have a 
greater probability of getting chosen to make a request it 
is easy to see that this will lead to the agent having higher 
total utility however this is just an artifact of our model 
to make our system simple to analyze we have assumed 
that request opportunities came uniformly at random in 
practice requests are made to satisfy a desire our model 
implicitly assumed that all agents are equally likely to have 
a desire at any particular time having sybils should not 
increase the need to have a request satisfied indeed it would 
be reasonable to assume that sybils do not make requests at 
all 
second having sybils makes it more likely that one of the 
sybils will be chosen to fulfill a request this can allow a 
user to increase his utility by setting a lower threshold that 
is to use a strategy sk where k is smaller than the k used 
by the nash equilibrium strategy intuitively the need for 
money is not as critical if money is easier to obtain 
unlike the first concern this seems like a real issue it seems 
reasonable to believe that when people make a decision 
between a number of nodes to satisfy a request they do so 
at random at least to some extent even if they look for 
advertised node features to help make this decision sybils 
would allow a user to advertise a wide range of features 
third an agent can drive down the cost of fulfilling a 
request by introducing many sybils similarly he could 
increase the cost and thus the value of his money by making 
a number of sybils leave the system concievably he could 
alternate between these techniques to magnify the effects of 
work he does we have not yet calculated the exact effect of 
this change it interacts with the other two effects of having 
sybils that we have already noted given the number of 
sybils that would be needed to cause a real change in the 
perceived size of a large p p network the practicality of this 
attack depends heavily on how much sybils cost an attacker 
and what resources he has available 
the second point raised regarding sybils also applies to 
collusion if we allow money to be loaned if k agents 
collude they can agree that if one runs out of money another 
in the group will loan him money by pooling their money 
in this way the k agents can again do better by setting a 
higher threshold note that the loan mechanism doesn t 
need to be built into the system the agents can simply use 
a fake transaction to transfer the money these appear 
to be the main avenues for collusive attacks but we are still 
exploring this issue 
 conclusion 
we have given a formal analysis of a scrip system and 
have shown that the existence of a nash equilibrium where 
all agents use a threshold strategy moreover we can 
compute efficiency of equilibrium strategy and optimize the price 
 or money supply to maximize efficiency thus our 
analysis provides a formal mechanisms for solving some important 
problems in implementing scrip systems it tells us that with 
a fixed population of rational users such systems are very 
unlikely to become unstable thus if this stability is 
common belief among the agents we would not expect inflation 
bubbles or crashes because of agent speculation however 
we cannot rule out the possibility that that agents may have 
other beliefs that will cause them to speculate our 
analysis also tells us how to scale the system to handle an influx 
of new users without introducing these problems scale the 
money supply to keep the average amount of money constant 
 or equivalently adjust prices to achieve the same goal 
there are a number of theoretical issues that are still open 
including a characterization of the multiplicity of 
equilibria - are there usually in addition we expect that one 
should be able to compute analytic estimates for the best 
response function and optimal pricing which would allow us 
to understand the relationship between pricing and various 
parameters in the model 
 
it would also be of great interest to extend our analysis 
to handle more realistic settings we mention a few possible 
extensions here 
 we have assumed that the world is homogeneous in a 
number of ways including request frequency utility 
and ability to satisfy requests it would be 
interesting to examine how relaxing any of these assumptions 
would alter our results 
 we have assumed that there is no cost to an agent 
to be a member of the system suppose instead that 
we imposed a small cost simply for being present in 
the system to reflect the costs of routing messages and 
overlay maintainance this modification could have a 
significant impact on sybil attacks 
 we have described a scrip system that works when 
there are no altruists and have shown that no system 
can work once there there are sufficiently many 
altruists what happens between these extremes 
 one type of irrational behavior encountered with 
scrip systems is hoarding there are some similarities 
between hoarding and altruistic behavior while an 
altruist provide service for everyone a hoarder will 
volunteer for all jobs in order to get more money and 
rarely request service so as not to spend money it 
would be interesting to investigate the extent to which 
our system is robust against hoarders clearly with 
too many hoarders there may not be enough money 
remaining among the non-hoarders to guarantee that 
typically a non-hoarder would have enough money to 
satisfy a request 
 finally in p p filesharing systems there are 
overlapping communities of various sizes that are significantly 
more likely to be able to satisfy each other s requests 
it would be interesting to investigate the effect of such 
communities on the equilibrium of our system 
there are also a number of implementation issues that 
would have to be resolved in a real system for example we 
need to worry about the possibility of agents counterfeiting 
money or lying about whether service was actually provided 
karma provdes techniques for dealing with both of these 
issues and a number of others but some of karma s 
implementation decisions point to problems for our model for 
example it is prohibitively expensive to ensure that bank 
account balances can never go negative a fact that our model 
does not capture another example is that karma has nodes 
serve as bookkeepers for other nodes account balances like 
maintaining a presence in the network this imposes a cost 
on the node but unlike that responsibility it can be easily 
shirked karma suggests several ways to incentivize nodes 
to perform these duties we have not investigated whether 
these mechanisms be incorporated without disturbing our 
equilibrium 
 acknowledgements 
we would like to thank emin gun sirer shane 
henderson jon kleinberg and anonymous referees for helpful 
suggestions ef ik and jh are supported in part by nsf 
under grant itr- jh is also supported in part 
by nsf under grants ctc- and iis- by 
onr under grant n - - - by the dod 
multidisciplinary university research initiative muri program 
administered by the onr under grants n - - - and 
n - - - and by afosr under grant 
f - - 
 references 
 e adar and b a huberman free riding on 
gnutella first monday 
 k g anagnostakis and m greenwald 
exchange-based incentive mechanisms for peer-to-peer 
file sharing in international conference on distributed 
computing systems icdcs pages - 
 bittorrent inc bittorrent web site 
http www bittorent com 
 a cheng and e friedman sybilproof reputation 
mechanisms in workshop on economics of 
peer-to-peer systems p pecon pages - 
 
 cornell information technologies cornell s 
ccommodity internet usage statistics 
http www cit cornell edu computer students 
bandwidth charts html 
 j r douceur the sybil attack in international 
workshop on peer-to-peer systems iptps pages 
 - 
 g ellison cooperation in the prisoner s dilemma 
with anonymous random matching review of 
economic studies - 
 emule project emule web site 
http www emule-project net 
 m feldman k lai i stoica and j chuang robust 
incentive techniques for peer-to-peer networks in 
acm conference on electronic commerce ec 
pages - 
 e j friedman and d c parkes pricing wifi at 
starbucks issues in online mechanism design in ec 
 proceedings of the th acm conference on 
electronic commerce pages - acm press 
 
 e j friedman and p resnick the social cost of 
cheap pseudonyms journal of economics and 
management strategy - 
 r guha r kumar p raghavan and a tomkins 
propagation of trust and distrust in conference on 
the world wide web www pages - 
 m gupta p judge and m h ammar a reputation 
system for peer-to-peer networks in network and 
operating system support for digital audio and 
video nossdav pages - 
 z gyongi p berkhin h garcia-molina and 
j pedersen link spam detection based on mass 
estimation technical report stanford university 
 
 j ioannidis s ioannidis a d keromytis and 
v prevelakis fileteller paying and getting paid for 
file storage in financial cryptography pages - 
 
 e t jaynes where do we stand on maximum 
entropy in r d levine and m tribus editors the 
maximum entropy formalism pages - mit 
press cambridge mass 
 
 s d kamvar m t schlosser and h garcia-molina 
the eigentrust algorithm for reputation management 
in p p networks in conference on the world wide 
web www pages - 
 m kandori social norms and community 
enforcement review of economic studies - 
 
 logisense corporation logisense web site 
http www logisense com tm p p html 
 l lovasz and p winkler mixing of random walks 
and other diffusions on a graph in surveys in 
combinatorics walker ed london 
mathematical society lecture note series 
cambridge university press 
 open source technology group slashdot 
faqcomments and moderation 
http slashdot org faq com-mod shtml cm 
 osmb llc gnutella web site 
http www gnutella com 
 m l puterman markov decision processes wiley 
 
 seti home seti home web page 
http setiathome ssl berkeley edu 
 sharman networks ltd kazaa web site 
http www kazaa com 
 v vishnumurthy s chandrakumar and e sirer 
karma a secure economic framework for peer-to-peer 
resource sharing in workshop on economics of 
peer-to-peer systems p pecon 
 l xiong and l liu building trust in decentralized 
peer-to-peer electronic communities in internation 
conference on electronic commerce research 
 icecr 
 h zhang a goel r govindan k mason and b v 
roy making eigenvector-based reputation systems 
robust to collusion in workshop on algorithms and 
models for the web-graph waw pages - 
 
 
