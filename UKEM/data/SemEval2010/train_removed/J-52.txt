hidden-action in multi-hop routing 
michal feldman 
mfeldman sims berkeley edu 
john chuang 
chuang sims berkeley edu 
ion stoica 
istoica cs berkeley edu 
scott shenker 
shenker icir org 
 
school of information 
management and systems 
u c berkeley 
 
computer science division 
u c berkeley 
abstract 
in multi-hop networks the actions taken by individual intermediate nodes 
are typically hidden from the communicating endpoints all the endpoints 
can observe is whether or not the end-to-end transmission was successful 
therefore in the absence of incentives to the contrary rational i e 
selfish intermediate nodes may choose to forward packets at a low priority 
or simply not forward packets at all using a principal-agent model we 
show how the hidden-action problem can be overcome through 
appropriate design of contracts in both the direct the endpoints contract with each 
individual router and recursive each router contracts with the next 
downstream router cases we further demonstrate that per-hop monitoring does 
not necessarily improve the utility of the principal or the social welfare in 
the system in addition we generalize existing mechanisms that deal with 
hidden-information to handle scenarios involving both hidden-information 
and hidden-action 
categories and subject descriptors 
c computer-communication networks distributed 
systems j social and behavioral sciences economics 
general terms 
design economics 
 introduction 
endpoints wishing to communicate over a multi-hop network 
rely on intermediate nodes to forward packets from the sender to 
the receiver in settings where the intermediate nodes are 
independent agents such as individual nodes in ad-hoc and 
peer-topeer networks or autonomous systems on the internet this poses 
an incentive problem the intermediate nodes may incur significant 
communication and computation costs in the forwarding of packets 
without deriving any direct benefit from doing so consequently a 
rational i e utility maximizing intermediate node may choose to 
forward packets at a low priority or not forward the packets at all 
this rational behavior may lead to suboptimal system performance 
the endpoints can provide incentives e g in the form of 
payments to encourage the intermediate nodes to forward their 
packets however the actions of the intermediate nodes are often hidden 
from the endpoints in many cases the endpoints can only observe 
whether or not the packet has reached the destination and cannot 
attribute failure to a specific node on the path even if some form 
of monitoring mechanism allows them to pinpoint the location of 
the failure they may still be unable to attribute the cause of failure 
to either the deliberate action of the intermediate node or to some 
external factors beyond the control of the intermediate node such 
as network congestion channel interference or data corruption 
the problem of hidden action is hardly unique to networks also 
known as moral hazard this problem has long been of interest in 
the economics literature concerning information asymmetry 
incentive and contract theory and agency theory we follow this 
literature by formalizing the problem as a principal-agent model where 
multiple agents making sequential hidden actions 
our results are threefold first we show that it is possible to 
design contracts to induce cooperation when intermediate nodes 
can choose to forward or drop packets as well as when the nodes 
can choose to forward packets with different levels of quality of 
service if the path and transit costs are known prior to 
transmission the principal achieves first best solution and can implement 
the contracts either directly with each intermediate node or 
recursively through the network each node making a contract with the 
following node without any loss in utility second we find that 
introducing per-hop monitoring has no impact on the principal s 
expected utility in equilibrium for a principal who wishes to induce 
an equilibrium in which all intermediate nodes cooperate its 
expected total payment is the same with or without monitoring 
however monitoring provides a dominant strategy equilibrium which 
is a stronger solution concept than the nash equilibrium achievable 
in the absence of monitoring third we show that in the absence 
of a priori information about transit costs on the packet forwarding 
path it is possible to generalize existing mechanisms to overcome 
scenarios that involve both hidden-information and hidden-action 
in these scenarios the principal pays a premium compared to 
scenarios with known transit costs 
 baseline model 
we consider a principal-agent model where the principal is a 
pair of communication endpoints who wish to communicate over 
a multi-hop network and the agents are the intermediate nodes 
capable of forwarding packets between the endpoints the 
principal who in practice can be either the sender the receiver or 
 
both makes individual take-it-or-leave-it offers contracts to the 
agents if the contracts are accepted the agents choose their 
actions sequentially to maximize their expected payoffs based on the 
payment schedule of the contract when necessary agents can in 
turn make subsequent take-it-or-leave-it offers to their downstream 
agents 
we assume that all participants are risk neutral and that standard 
assumptions about the global observability of the final outcome and 
the enforceability of payments by guaranteeing parties hold 
for simplicity we assume that each agent has only two possible 
actions one involving significant effort and one involving little 
effort we denote the action choice of agent i by ai ∈ where 
ai and ai stand for the low-effort and high-effort actions 
respectively each action is associated with a cost to the agent 
c ai and we assume 
c ai c ai 
at this stage we assume that all nodes have the same c ai for 
presentation clarity but we relax this assumption later without loss 
of generality we normalize the c ai to be zero and denote 
the high-effort cost by c so c ai and c ai c 
the utility of agent i denoted by ui is a function of the payment 
it receives from the principal si the action it takes ai and the 
cost it incurs ci as follows 
ui si ci ai si − aici 
the outcome is denoted by x ∈ xg 
 xb 
 where xg 
stands 
for the good outcome in which the packet reaches the 
destination and xb 
stands for the bad outcome in which the packet 
is dropped before it reaches the destination the outcome is a 
function of the vector of actions taken by the agents on the path 
a a an ∈ n 
 and the loss rate on the channels k 
the benefit of the sender from the outcome is denoted by w x 
where 
w xg 
 wg 
 and w xb 
 wb 
 
the utility of the sender is consequently 
u x s w x − s 
where s 
pn 
i si 
a sender who wishes to induce an equilibrium in which all nodes 
engage in the high-effort action needs to satisfy two constraints for 
each agent i 
 ir individual rationality participation constraint 
 the 
expected utility from participation should weakly exceed its 
reservation utility which we normalize to 
 ic incentive compatibility the expected utility from exerting 
high-effort should weakly exceed its expected utility from 
exerting low-effort 
in some network scenarios the topology and costs are common 
knowledge that is the sender knows in advance the path that its 
packet will take and the costs on that path in other routing 
scenarios the sender does not have this a priori information we show 
that our model can be applied to both scenarios with known and 
unknown topologies and costs and highlight the implications of each 
scenario in the context of contracts we also distinguish between 
direct contracts where the principal signs an individual contract 
 we use the notion of ex ante individual rationality in which the agents 
choose to participate before they know the state of the system 
s dn 
source destination 
n intermediate nodes 
figure multi-hop path from sender to destination 
figure structure of the multihop routing game under known 
topology and transit costs 
with each node and recursive contracts where each node enters a 
contractual relationship with its downstream node 
the remainder of this paper is organized as follows in section 
we consider agents who decide whether to drop or forward 
packets with and without monitoring when the transit costs are common 
knowledge in section we extend the model to scenarios with 
unknown transit costs in section we distinguish between recursive 
and direct contracts and discuss their relationship in section we 
show that the model applies to scenarios in which agents choose 
between different levels of quality of service we consider internet 
routing as a case study in section in section we present related 
work and section concludes the paper 
 known transit costs 
in this section we analyze scenarios in which the principal knows 
in advance the nodes on the path to the destination and their costs 
as shown in figure we consider agents who decide whether to 
drop or forward packets and distinguish between scenarios with 
and without monitoring 
 drop versus forward without monitoring 
in this scenario the agents decide whether to drop a or 
forward a packets the principal uses no monitoring to 
observe per-hop outcomes consequently the principal makes the 
payment schedule to each agent contingent on the final outcome x 
as follows 
si x sb 
i sg 
i 
where 
sb 
i si x xb 
 
sg 
i si x xg 
 
the timeline of this scenario is shown in figure given a 
perhop loss rate of k we can express the probability that a packet is 
successfully delivered from node i to its successor i as 
pr xg 
i→i ai − k ai 
where xg 
i→j denotes a successful transmission from node i to j 
proposition under the optimal contract that induces 
high-effort behavior from all intermediate nodes in the nash 
equi 
librium 
 the expected payment to each node is the same as its 
expected cost with the following payment schedule 
sb 
i si x xb 
 
sg 
i si x xg 
 
c 
 − k n−i 
 
proof the principal needs to satisfy the ic and ir 
constraints for each agent i which can be expressed as follows 
 ic pr xg 
 aj≥i sg 
i pr xb 
 aj≥i sb 
i − c ≥ 
pr xg 
 ai aj i sg 
i pr xb 
 ai aj i sb 
i 
 
this constraint says that the expected utility from forwarding is 
greater than or equal to its expected utility from dropping if all 
subsequent nodes forward as well 
 ir pr xg 
s→i aj i pr xg 
 aj≥i sg 
i 
pr xb 
 aj≥i sb 
i − c pr xb 
s→i aj i sb 
i ≥ 
 
this constraint says that the expected utility from participating is 
greater than or equal to zero reservation utility if all other nodes 
forward 
the above constraints can be expressed as follows based on 
eq 
 ic − k n−i 
sg 
i − − k n−i 
 sb 
i − c ≥ sb 
i 
 ir −k i 
 −k n−i 
sg 
i − −k n−i 
 sb 
i −c 
 − − k i 
 sb 
i ≥ 
it is a standard result that both constraints bind at the optimal 
contract see solving the two equations we obtain the 
solution that is presented in eqs and 
we next prove that the expected payment to a node equals its 
expected cost in equilibrium the expected cost of node i is its 
transit cost multiplied by the probability that it faces this cost i e 
the probability that the packet reaches node i which is − k i 
c 
the expected payment that node i receives is 
pr xg 
 sg 
i pr xb 
 sb 
i − k n c 
 − k n−i 
 − k i 
c 
note that the expected payment to a node decreases as the node 
gets closer to the destination due to the asymmetric distribution 
of risk the closer the node is to the destination the lower the 
probability that a packet will fail to reach the destination resulting 
in the low payment being made to the node 
the expected payment by the principal is 
e s − k n 
nx 
i 
sg 
i − − k n 
 
nx 
i 
sb 
i 
 − k n 
nx 
i 
ci 
 − k n−i 
 
the expected payment made by the principal depends not only 
on the total cost but also the number of nodes on the path 
proposition given two paths with respective lengths of 
n and n hops per-hop transit costs of c and c and per-hop 
loss rates of k and k such that 
 since transit nodes perform actions sequentially this is really a 
subgameperfect equilibrium spe but we will refer to it as nash equilibrium in the 
remainder of the paper 
figure two paths of equal total costs but different lengths and 
individual costs 
 c n c n equal total cost 
 − k n 
 − k n 
 equal expected benefit 
 n n path is shorter than path 
the expected total payment made by the principal is lower on the 
shorter path 
proof the expected payment in path j is 
e s j 
nj 
x 
i 
cj − kj i 
 cj − kj 
 − − kj nj 
kj 
so we have to show that 
c − k 
 − − k n 
k 
 c − k 
 − − k n 
k 
let m c n c n and n − k n 
 − k n 
 
we have to show that 
mn 
 
n − n 
n 
n 
n − n 
 
n 
 
mn 
 
n − n 
n 
n 
n − n 
 
n 
 
let 
f 
n 
 
n − n 
n 
n 
n − n 
 
n 
then it is enough to show that f is monotonically increasing in n 
∂f 
∂n 
 
g n n 
h n n 
where 
g n n − ln n n − n 
 n 
 
n 
− n 
n 
n − n 
 n n 
 
n 
and 
h n n n 
n 
 − n 
 
n 
but h n n ∀n n therefore it is enough to show that 
g n n because n ∈ i ln n and ii 
n 
 
n n 
n 
n therefore g n n ∀n n 
this means that ceteris paribus shorter paths should always be 
preferred over longer ones 
for example consider the two topologies presented in figure 
while the paths are of equal total cost the total expected payment 
by the principal is different based on eqs and the expected 
total payment for the top path is 
e s pr xg 
 sg 
a sg 
b 
 
„ 
c 
 − k 
 
c 
 − k 
 
 − k 
 
 
while the expect total payment for the bottom path is 
e s pr xg 
 sg 
a sg 
b sg 
c 
 
c 
 − k 
 
c 
 − k 
 
c 
 − k 
 − k 
for n c k n c k 
we have equal total cost and equal expected benefit but e s 
 and e s 
 drop versus forward with monitoring 
suppose the principal obtains per-hop monitoring information 
per-hop information broadens the set of mechanisms the principal 
can use for example the principal can make the payment schedule 
contingent on arrival to the next hop instead of arrival to the final 
destination can such information be of use to a principal wishing 
to induce an equilibrium in which all intermediate nodes forward 
the packet 
proposition in the drop versus forward model the 
principal derives the same expected utility whether it obtains per-hop 
monitoring information or not 
proof the proof to this proposition is already implied in the 
findings of the previous section we found that in the absence of 
per-hop information the expected cost of each intermediate node 
equals its expected payment in order to satisfy the ir constraint it 
is essential to pay each intermediate node an expected amount of at 
least its expected cost otherwise the node would be better-off not 
participating therefore no other payment scheme can reduce the 
expected payment from the principal to the intermediate nodes in 
addition if all nodes are incentivized to forward packets the 
probability that the packet reaches the destination is the same in both 
scenarios thus the expected benefit of the principal is the same 
indeed we have found that even in the absence of per-hop monitoring 
information the principal achieves first-best solution 
to convince the reader that this is indeed the case we provide an 
example of a mechanism that conditions payments on arrival to the 
next hop this is possible only if per-hop monitoring information 
is provided in the new mechanism the principal makes the 
payment schedule contingent on whether the packet has reached the 
next hop or not that is the payment to node i is sg 
i if the packet 
has reached node i and sb 
i otherwise we assume costless 
monitoring giving us the best case scenario for the use of 
monitoring as before we consider a principal who wishes to induce an 
equilibrium in which all intermediate nodes forward the packet 
the expected utility of the principal is the difference between its 
expected benefit and its expected payment because the expected 
benefit when all nodes forward is the same under both scenarios 
we only need to show that the expected total payment is identical as 
well under the monitoring mechanism the principal has to satisfy 
the following constraints 
 ic pr xg 
i→i ai sg 
 pr xb 
i→i ai sb 
− c ≥ 
pr xg 
i→i ai sg 
 pr xb 
i→i ai sb 
 
 ir pr xg 
s→i aj i pr xg 
i→i ai sg 
 pr xb 
i→i ai sb 
− c ≥ 
 
 for a recent proposal of an accountability framework that provides such 
monitoring information see 
these constraints can be expressed as follows 
 ic − k sg 
 ksb 
− c ≥ s 
 ir − k i 
 − k sg 
 ksb 
− c ≥ 
the two constraints bind at the optimal contract as before and 
we get the following payment schedule 
sb 
 
sg 
 
c 
 − k 
the expected total payment under this scenario is 
e s 
nx 
i 
 − k i 
 sb 
 i − sg 
 − k n 
nsg 
 − k n 
nx 
i 
ci 
 − k n−i 
as in the scenario without monitoring see equation 
while the expected total payment is the same with or without 
monitoring there are some differences between the two scenarios 
first the payment structure is different if no per-hop monitoring 
is used the payment to each node depends on its location i in 
contrast monitoring provides us with n identical contracts 
second the solution concept used is different if no monitoring 
is used the strategy profile of ai ∀i is a nash equilibrium 
which means that no agent has an incentive to deviate unilaterally 
from the strategy profile in contrast with the use of monitoring 
the action chosen by node i is independent of the other agents 
forwarding behavior therefore monitoring provides us with 
dominant strategy equilibrium which is a stronger solution concept than 
nash equilibrium discuss the appropriateness of 
different solution concepts in the context of online environments 
 unknown transit costs 
in certain network settings the transit costs of nodes along the 
forwarding path may not be common knowledge i e there exists 
the problem of hidden information in this section we address the 
following questions 
 is it possible to design contracts that induce cooperative 
behavior in the presence of both hidden-action and 
hiddeninformation 
 what is the principal s loss due to the lack of knowledge of 
the transit costs 
in hidden-information problems the principal employs 
mechanisms to induce truthful revelation of private information from the 
agents in the routing game the principal wishes to extract transit 
cost information from the network routers in order to determine the 
lowest cost path lcp for a given source-destination pair the 
network routers act strategically and declare transit costs to maximize 
their profit mechanisms that have been proposed in the literature 
for the routing game assume that once the transit costs 
have been obtained and the lcp has been determined the nodes 
on the lcp obediently forward all packets and that there is no loss 
in the network i e k in this section we consider both hidden 
information and hidden action and generalize these mechanisms 
to induce both truth revelation and high-effort action in 
equilibrium where nodes transmit over a lossy communication channel 
i e k ≥ 
 v cg mechanism 
in their seminal paper nisan and ronen present a vcg 
mechanism that induces truthful revelation of transit costs by edges 
 
figure game structure for f p ss where only hidden-information 
is considered 
figure game structure for f p ss where both 
hiddeninformation and hidden-action are considered 
in a biconnected network such that lowest cost paths can be 
chosen like all vcg mechanisms it is a strategyproof mechanism 
meaning that it induces truthful revelation in a dominant strategy 
equilibrium in fpss feigenbaum et al slightly modify 
the model to have the routers as the selfish agents instead of the 
edges and present a distributed algorithm that computes the vcg 
payments the timeline of the fpss game is presented in 
figure under fpss transit nodes keep track of the amount of 
traffic routed through them via counters and payments are 
periodically transferred from the principals to the transit nodes based on 
the counter values fpss assumes that transit nodes are 
obedient in packet forwarding behavior and will not update the counters 
without exerting high effort in packet forwarding 
in this section we present fpss which generalizes fpss to 
operate in an environment with lossy communication channels i e 
k ≥ and strategic behavior in terms of packet forwarding we 
will show that fpss induces an equilibrium in which all nodes 
truthfully reveal their transit costs and forward packets if they are 
on the lcp figure presents the timeline of fpss in the first 
stage the sender declares two payment functions sg 
i sb 
i that 
will be paid upon success or failure of packet delivery given these 
payments nodes have incentive to reveal their costs truthfully and 
later to forward packets payments are transferred based on the 
final outcome 
in fpss each node i submits a bid bi which is its reported 
transit cost node i is said to be truthful if bi ci we write b for 
the vector b bn of bids submitted by all transit nodes let 
ii b be the indicator function for the lcp given the bid vector b 
such that 
ii b 
 
 if i is on the lcp 
 otherwise 
following fpss the payment received by node i at 
equilibrium is 
pi biii b 
x 
r 
ir b i 
∞ br − 
x 
r 
ir b br 
 
x 
r 
ir b i 
∞ br − 
x 
r i 
ir b br 
 
where the expression b i 
x means that b i 
x j cj for all j i 
and b i 
x i x 
in fpss we compute sb 
i and sg 
i as a function of pi k and 
n first we recognize that sb 
i must be less than or equal to zero 
in order for the true lcp to be chosen otherwise strategic nodes 
may have an incentive to report extremely small costs to mislead 
the principal into believing that they are on the lcp then these 
nodes can drop any packets they receive incur zero transit cost 
collect a payment of sb 
i and earn positive profit 
proposition let the payments of fpss be 
sb 
i 
sg 
i 
pi 
 − k n−i 
then fpss has a nash equilibrium in which all nodes truthfully 
reveal their transit costs and all nodes on the lcp forward packets 
proof in order to prove the proposition above we have to 
show that nodes have no incentive to engage in the following 
misbehaviors 
 truthfully reveal cost but drop packet 
 lie about cost and forward packet 
 lie about cost and drop packet 
if all nodes truthfully reveal their costs and forward packets the 
expected utility of node i on the lcp is 
e u i pr xg 
s→i e si − ci pr xb 
s→i sb 
i 
 − k i 
 
 − k n−i 
sg 
i − − k n−i 
 sb 
i − ci 
 
 − − k i 
 sb 
i 
 − k i 
 − k n−i pi 
 − k n−i 
− − k i 
ci 
 − k i 
 pi − ci 
≥ 
 
the last inequality is derived from the fact that fpss is a truthful 
mechanism thus pi ≥ ci the expected utility of a node not on the 
lcp is 
a node that drops a packet receives sb 
i which is smaller 
than or equal to e u i for i ∈ lcp and equals e u i for i ∈ lcp 
therefore nodes cannot gain utility from misbehaviors or 
we next show that nodes cannot gain utility from misbehavior 
 if i ∈ lcp e u i 
 a if it reports bi ci 
i if bi 
p 
r ir b i 
∞ br − 
p 
r i ir b br it is still 
on the lcp and since the payment is independent 
of bi its utility does not change 
ii if bi 
p 
r ir b i 
∞ br − 
p 
r i ir b br it will 
not be on the lcp and obtain e u i which is 
less than its expected utility if truthfully revealing 
its cost 
 
 b if it reports bi ci it is still on the lcp and since 
the payment is independent of bi its utility does not 
change 
 if i ∈ lcp e u i 
 a if it reports bi ci it remains out of the lcp so its 
utility does not change 
 b if it reports bi ci 
i if bi 
p 
r ir b i 
∞ br − 
p 
r i ir b br it joins 
the lcp and gains an expected utility of 
e u i − k i 
 pi − ct 
however if i ∈ lcp it means that 
ci 
x 
r 
ir c i 
∞ cr − 
x 
r i 
ir c cr 
but if all nodes truthfully reveal their costs 
pi 
x 
r 
ir c i 
∞ cr − 
x 
r i 
ir c cr ci 
therefore e u i 
ii if bi 
p 
r ir b i 
∞ br − 
p 
r i ir b br it 
remains out of the lcp so its utility does not change 
therefore there exists an equilibrium in which all nodes truthfully 
reveal their transit costs and forward the received packets 
we note that in the hidden information only context fpss 
induces truthful revelation as a dominant strategy equilibrium in 
the current setting with both hidden information and hidden action 
fpss achieves a nash equilibrium in the absence of per-hop 
monitoring and a dominant strategy equilibrium in the presence of 
per-hop monitoring consistent with the results in section where 
there is hidden action only in particular with per-hop monitoring 
the principal declares the payments sb 
i and sg 
i to each node upon 
failure or success of delivery to the next node given the payments 
sb 
i and sg 
i pi − k it is a dominant strategy for the 
nodes to reveal costs truthfully and forward packets 
 discussion 
more generally for any mechanism m that induces a bid vector b 
in equilibrium by making a payment of pi b to node i on the lcp 
there exists a mechanism m that induces an equilibrium with the 
same bid vector and packet forwarding by making a payment of 
sb 
i 
sg 
i 
pi b 
 − k n−i 
 
a sketch of the proof would be as follows 
 im 
i b im 
i b ∀i since m uses the same choice metric 
 the expected utility of a lcp node is e u i − 
k i 
 pi b − ci ≥ if it forwards and if it drops and 
the expected utility of a non-lcp node is 
 from and we get that if a node i can increase its expected 
utility by deviating from bi under m it can also increase its 
utility by deviating from bi in m but this is in contradiction 
to bi being an equilibrium in m 
 nodes have no incentive to drop packets since they derive an 
expected utility of if they do 
in addition to the generalization of fpss into fpss we 
can also consider the generalization of the first-price auction fpa 
mechanism where the principal determines the lcp and pays each 
node on the lcp its bid pi b bi first-price auctions achieve 
nash equilibrium as opposed to dominant strategy equilibrium 
therefore we should expect the generalization of fpa to achieve 
nash equilibrium with or without monitoring 
we make two additional comments concerning this class of 
mechanisms first we find that the expected total payment made 
by the principal under the proposed mechanisms is 
e s 
nx 
i 
 − k i 
pi b 
and the expected benefit realized by the principal is 
e w − k n 
wg 
where 
pn 
i pi and wg 
are the expected payment and expected 
benefit respectively when only the hidden-information problem is 
considered when hidden action is also taken into consideration 
the generalized mechanism handles strategic forwarding behavior 
by conditioning payments upon the final outcome and accounts for 
lossy communication channels by designing payments that reflect 
the distribution of risk the difference between expected payment 
and benefit is not due to strategic forwarding behavior but to lossy 
communications therefore in a lossless network we should not 
see any gap between expected benefits and payments independent 
of strategic or non-strategic forwarding behavior 
second the loss to the principal due to unknown transit costs is 
also known as the price of frugality and is an active field of 
research this price greatly depends on the network topology 
and on the mechanism employed while it is simple to characterize 
the principal s loss in some special cases it is not a trivial problem 
in general for example in topologies with parallel disjoint paths 
from source to destination we can prove that under first-price 
auctions the loss to the principal is the difference between the cost of 
the shortest path and the second-shortest path and the loss is higher 
under the fpss mechanism 
 recursive contracts 
in this section we distinguish between direct and recursive 
contracts in direct contracts the principal contracts directly with each 
node on the path and pays it directly in recursive payment the 
principal contracts with the first node on the path which in turn 
contracts with the second and so on such that each node contracts 
with its downstream node and makes the payment based on the final 
result as demonstrated in figure 
with direct payments the principal needs to know the identity 
and cost of each node on the path and to have some communication 
channel with the node with recursive payments every node needs 
to communicate only with its downstream node several questions 
arise in this context 
 what knowledge should the principal have in order to induce 
cooperative behavior through recursive contracts 
 what should be the structure of recursive contracts that 
induce cooperative behavior 
 what is the relation between the total expected payment 
under direct and recursive contracts 
 is it possible to design recursive contracts in scenarios of 
unknown transit costs 
 
figure structure of the multihop routing game under known 
topology and recursive contracts 
in order to answer the questions outlined above we look at the 
ir and ic constraints that the principal needs to satisfy when 
contracting with the first node on the path when the principal designs 
a contract with the first node he should take into account the 
incentives that the first node should provide to the second node and 
so on all the way to the destination 
for example consider the topology given in figure a when 
the principal comes to design a contract with node a he needs to 
consider the subsequent contract that a should sign with b which 
should satisfy the following constrints 
 ir pr xg 
a→b aa e s ab − c 
pr xb 
a→b aa sb 
a→b ≥ 
 ic e s ab − c ≥ e s ab 
where 
e s ab pr xg 
b→d ab sg 
a→b 
 pr xb 
b→d ab sb 
a→b 
and 
e s ab pr xg 
b→d ab sg 
a→b 
 pr xb 
b→d ab sb 
a→b 
these binding constraints yield the values of sb 
a→b and sg 
a→b 
sb 
a→b 
sg 
a→b c − k 
based on these values s can express the constraints it should 
satisfy in a contract with a 
 ir pr xg 
s→a as e ss→a − sa→b ai ∀i − c 
 pr xb 
s→a as sb 
s→a ≥ 
 ic e ss→a − sa→b ai ∀i − c 
≥ e ss→a − sa→b aa ab 
where 
e ss→a − sa→b ai ∀i 
pr xg 
a→d ai ∀i sg 
s→a − sg 
a→b 
 pr xb 
a→d ai ∀i sb 
s→a − sb 
a→b 
and 
e ss→a − sa→b aa ab 
pr xg 
a→d aa ab sg 
s→a − sg 
a→b 
 pr xb 
a→d aa ab sb 
s→a − sb 
a→b 
solving for sb 
s→a and sg 
s→a we get 
sb 
s→a 
sg 
s→a 
c − k 
 − k k 
the expected total payment is 
e s sg 
s→apr xg 
s→d sb 
s→apr xb 
s→d 
 c − k − k 
 
which is equal to the expected total payment under direct contracts 
 see eq 
proposition the expected total payments by the 
principal under direct and recursive contracts are equal 
proof in order to calculate the expected total payment we 
have to find the payment to the first node on the path that will 
induce appropriate behavior because sb 
i in the drop forward 
model both constraints can be reduced to 
pr xg 
i→r aj ∀j sg 
i − sg 
i − ci 
⇔ − k n−i 
 sg 
i − sg 
i − ci 
which yields for all ≤ i ≤ n 
sg 
i 
ci 
 − k n−i 
 sg 
i 
thus 
sg 
n 
cn 
 − k 
sg 
n− 
cn− 
 − k 
 sg 
n 
cn− 
 − k 
 
cn 
 − k 
· · · 
sg 
 
c 
 − k n 
 sg 
 
nx 
i 
ci 
 − k i 
and the expected total payment is 
e s − k n 
sg 
 − k n 
nx 
i 
ci 
 − k n−i 
which equals the total expected payment in direct payments as 
expressed in eq 
because the payment is contingent on the final outcome and the 
expected payment to a node equals its expected cost nodes have 
no incentive to offer their downstream nodes lower payment than 
necessary since if they do their downstream nodes will not forward 
the packet 
what information should the principal posess in order to 
implement recursive contracts like in direct payments the expected 
payment is not affected solely by the total payment on the path but 
also by the topology therefore while the principal only needs to 
communicate with the first node on the forwarding path and does 
not have to know the identities of the other nodes it still needs to 
know the number of nodes on the path and their individual transit 
costs 
finally is it possible to design recursive contracts under 
unknown transit costs and if so what should be the structure of such 
contracts suppose the principal has implemented the distributed 
algorithm that calculates the necessary payments pi for truthful 
 
revelation would the following payment schedule to the first node 
induce cooperative behavior 
sb 
 
sg 
 
nx 
i 
pi 
 − k i 
the answer is not clear unlike contracts in known transit costs 
the expected payment to a node usually exceeds its expected cost 
therefore transit nodes may not have the appropriate incentive to 
follow the principal s guarantee during the payment phase for 
example in fpss the principal guarantees to pay each node an 
expected payment of pi ci we assume that payments are 
enforceable if made by the same entity that pledge to pay however in the 
case of recursive contracts the entity that pledges to pay in the cost 
discovery stage the principal is not the same as the entity that 
defines and executes the payments in the forwarding stage the transit 
nodes transit nodes who design the contracts in the second stage 
know that their downstream nodes will forward the packet as long 
as the expected payment exceeds the expected cost even if it is less 
than the promised amount thus every node has incentive to offer 
lower payments than promised and keep the profit transit nodes 
who know this is a plausible scenario may no longer truthfully 
reveal their cost therefore while recursive contracts under known 
transit costs are strategically equivalent to direct contracts it is not 
clear whether this is the case under unknown transit costs 
 high-quality versus 
low-quality forwarding 
so far we have considered the agents strategy space to be 
limited to the drop a and forward a actions in this 
section we consider a variation of the model where the agents choose 
between providing a low-quality service a and a high-quality 
service a 
this may correspond to a service-differentiated service model 
where packets are forwarded on a best-effort or a priority basis 
in contrast to drop versus forward a packet may still reach the next 
hop albeit with a lower probability even if the low-effort action is 
taken 
as a second example consider the practice of hot-potato routing 
in inter-domain routing of today s internet individual autonomous 
systems as s can either adopt hot-potato routing or early exit 
routing a where a packet is handed off to the downstream 
as at the first possible exit or late exit routing a where an 
as carries the packet longer than it needs to handing off the packet 
at an exit closer to the destination in the absence of explicit 
incentives it is not surprising that as s choose hot-potato routing to 
minimize their costs even though it leads to suboptimal routes 
 
in both examples in the absence of contracts a rational node 
would exert low-effort resulting in lower performance 
nevertheless this behavior can be avoided with an appropriate design of 
contracts 
formally the probability that a packet successfully gets from 
node i to node i is 
pr xg 
i→i ai − k − qai 
where q ∈ and k ∈ q 
in the drop versus forward model a low-effort action by any node 
results in a delivery failure in contrast a node in the high low 
scenario may exert low-effort and hope to free-ride on the 
higheffort level exerted by the other agents 
proposition in the high-quality versus low-quality 
forwarding model where transit costs are common knowledge the 
principal derives the same expected utility whether it obtains 
perhop monitoring information or not 
proof the ic and ir constraints are the same as specified 
in the proof of proposition but their values change based on 
eq to reflect the different model 
 ic −k q n−i 
sg 
i − −k q n−i 
 sb 
i −c ≥ 
 − k − k q n−i 
sg 
i − − k − k q n−i 
 sb 
i 
 ir − k q i 
 − k q n−i 
sg 
i 
 − − k q n−i 
 sb 
i − c − − k q i 
 sb 
i ≥ 
for this set of constraints we obtain the following solution 
sb 
i 
 − k q i 
c k − 
q 
 
sg 
i 
 − k q i 
c k − − k q −n 
 
q 
 
we observe that in this version both the high and the low payments 
depend on i if monitoring is used we obtain the following 
constraints 
 ic − k q sg 
i k − q sb 
i − c ≥ − k sg 
i k sb 
i 
 ir − k q i 
 − k q sg 
i k − q sb 
i − c ≥ 
and we get the solution 
sb 
i 
c k − 
q 
sg 
i 
ck 
q 
the expected payment by the principal with or without forwarding 
is the same and equals 
e s 
c − k q − − k q n 
 
k − q 
 
and this concludes the proof 
the payment structure in the high-quality versus low-quality 
forwarding model is different from that in the drop versus forward 
model in particular at the optimal contract the low-outcome 
payment sb 
i is now less than zero a negative payment means that 
the agent must pay the principal in the event that the packet fails 
to reach the destination in some settings it may be necessary to 
impose a limited liability constraint i e si ≥ this prevents the 
first-best solution from being achieved 
proposition in the high-quality versus low-quality 
forwarding model if negative payments are disallowed the expected 
payment to each node exceeds its expected cost under the optimal 
contract 
proof the proof is a direct outcome of the following 
statements which are proved above 
 the optimal contract is the contract specified in equations 
and 
 under the optimal contract e si equals node i s expected 
cost 
 under the optimal contract sb 
i −k q i 
c k− 
q 
 
therefore under any other contract the sender will have to 
compensate each node with an expected payment that is higher than its 
expected transit cost 
 
there is an additional difference between the two models in 
drop versus forward a principal either signs a contract with all n 
nodes along the path or with none this is because a single node 
dropping the packet determines a failure in contrast in high versus 
low-quality forwarding a success may occur under the low effort 
actions as well and payments are used to increase the probability 
of success therefore it may be possible for the principal to 
maximize its utility by contracting with only m of the n nodes along the 
path while the expected outcome depends on m it is independent 
of which specific m nodes are induced at the same time the 
individual expected payments decrease in i see eq therefore 
a principal who wishes to sign a contract with only m out of the n 
nodes should do so with the nodes that are closest to the destination 
namely nodes n − m n − n 
solving for the high-quality versus low-quality forwarding 
model with unknown transit costs is left for future work 
 case study internet routing 
we can map different deployed and proposed internet routing 
schemes to the various models we have considered in this work 
border gateway protocol bgp the current inter-domain 
routing protocol in the internet computes routes based on path vectors 
since the protocol reveals only the autonomous systems as s 
along a route but not the cost associated to them the current bgp 
routing is best characterized by lack of a priori information about 
transit costs in this case the principal e g a multi-homed site 
or a tier- as can implement one of the mechanisms proposed in 
section by contracting with individual nodes on the path such 
contracts involve paying some premium over the real cost and it 
is not clear whether recursive contacts can be implemented in this 
scenario in addition the current protocol does not have the 
infrastructure to support implementation of direct contracts between 
endpoints and the network 
recently several new architectures have been proposed in the 
context of the internet to provide the principal not only with a set 
of paths from which it can chose like bgp does but also with 
the performance along those paths and the network topology one 
approach to obtain such information is through end-to-end 
probing another approach is to have the edge networks perform 
measurements and discover the network topology yet another 
approach is to delegate the task of obtaining topology and 
performance information to a third-party like in the routing-as-a-service 
proposal these proposals are quite different in nature but 
they are common in their attempt to provide more visibility and 
transparency into the network if information about topology and 
transit costs is obtained the scenario is mapped to the known 
transit costs model section in this case first-best contracts can be 
achieved through individual contracts with nodes along the path 
however as we have shown in section as long as each agent can 
chose the next hop the principal can gain full benefit by 
contracting with only the first hop through the implementation of recursive 
contracts 
however the various proposals for acquiring network topology 
and performance information do not deal with strategic behavior 
by the intermediate nodes with the realization that the 
information collected may be used by the principal in subsequent 
contractual relationships the intermediate nodes may behave strategically 
misrepresenting their true costs to the entities that collect and 
aggregate such information one recent approach that can alleviate 
this problem is to provide packet obituaries by having each packet 
to confirm its delivery or report its last successful as hop 
another approach is to have third parties like keynote independently 
monitor the network performance 
 related work 
the study of non-cooperative behavior in communication 
networks and the design of incentives has received significant 
attention in the context of wireless ad-hoc routing considers the 
problem of malicious behavior where nodes respond positively to 
route requests but then fail to forward the actual packets it 
proposes to mitigate it by detection and report mechanisms that will 
essentially help to route around the malicious nodes however 
rather than penalizing nodes that do not forward traffic it bypasses 
the misbehaving nodes thereby relieving their burden therefore 
such a mechanism is not effective against selfish behavior 
in order to mitigate selfish behavior some approaches 
require reputation exchange between nodes or simply first-hand 
observations other approaches propose payment schemes 
 to encourage cooperation is the closest to our work in 
that it designs payment schemes in which the sender pays the 
intermediate nodes in order to prevent several types of selfish behavior 
in their approach nodes are supposed to send receipts to a 
thirdparty entity we show that this type of per-hop monitoring may not 
be needed 
in the context of internet routing proposes an accountability 
framework that provide end hosts and service providers 
after-thefact audits on the fate of their packets this proposal is part of a 
broader approach to provide end hosts with greater control over the 
path of their packets if senders have transit cost 
information and can fully control the path of their packets they can design 
contracts that yield them with first-best utility the accountability 
framework proposed in can serve two main goals informing 
nodes of network conditions to help them make informed decision 
and helping entities to establish whether individual ass have 
performed their duties adequately while such a framework can be 
used for the first task we propose a different approach to the 
second problem without the need of per-hop auditing information 
research in distributed algorithmic mechanism design damd 
has been applied to bgp routing these works propose 
mechanisms to tackle the hidden-information problem but ignore 
the problem of forwarding enforcement inducing desired behavior 
is also the objective in which attempts to respond to the 
challenge of distributed amd raised in if the same agents that 
seek to manipulate the system also run the mechanism what 
prevents them from deviating from the mechanism s proposed rules to 
maximize their own welfare they start with the proposed 
mechanism presented in and use mostly auditing mechanisms to 
prevent deviation from the algorithm 
the focus of this work is the design of a payment scheme that 
provides the appropriate incentives within the context of multi-hop 
routing like other works in this field we assume that all the 
accounting services are done using out-of-band mechanisms 
security issues within this context such as node authentication or 
message encryption are orthogonal to the problem presented in this 
paper and can be found for example in 
the problem of information asymmetry and hidden-action also 
known as moral hazard is well studied in the economics 
literature identifies the problem of moral hazard in 
production teams and shows that it is impossible to design a 
sharing rule which is efficient and budget-balanced shows that this 
task is made possible when production takes place sequentially 
 conclusions and future 
directions 
in this paper we show that in a multi-hop routing setting where 
the actions of the intermediate nodes are hidden from the source 
 
and or destination it is possible to design payment schemes to 
induce cooperative behavior from the intermediate nodes we 
conclude that monitoring per-hop outcomes may not improve the 
utility of the participants or the network performace in addition in 
scenarios of unknown transit costs it is also possible to design 
mechanisms that induce cooperative behavior in equilibrium but 
the sender pays a premium for extracting information from the 
transit nodes 
our model and results suggest several natural and intriguing 
research avenues 
 consider manipulative or collusive behaviors which may 
arise under the proposed payment schemes 
 analyze the feasibility of recursive contracts under 
hiddeninformation of transit costs 
 while the proposed payment schemes sustain cooperation in 
equilibrium it is not a unique equilibrium we plan to study 
under what mechanisms this strategy profile may emerge as 
a unique equilibrium e g penalty by successor nodes 
 consider the effect of congestion and capacity constraints on 
the proposed mechanisms our preliminary results show that 
when several senders compete for a single transit node s 
capacity the sender with the highest demand pays a premium 
even if transit costs are common knowledge the premium 
can be expressed as a function of the second-highest demand 
in addition if congestion affects the probability of 
successful delivery a sender with a lower cost alternate path may 
end up with a lower utility level than his rival with a higher 
cost alternate path 
 fully characterize the full-information nash equilibrium in 
first price auctions and use this characterization to derive its 
overcharging compared to truthful mechaisms 
 acknowledgements 
we thank hal varian for his useful comments this work is 
supported in part by the national science foundation under itr 
awards ani- and ani- and career award 
ani 
 references 
 andersen d g balakrishnan h kaashoek m f and 
morris r resilient overlay networks in th acm sosp 
 archer a and tardos e frugal path mechanisms 
 argyraki k and cheriton d loose source routing as a 
mechanism for traffic policies in proceedings of sigcomm fdna 
 august 
 argyraki k maniatis p cheriton d and shenker s 
providing packet obituaries in third workshop on hot topics in 
networks hotnets november 
 bansal s and baker m observation-based cooperation 
enforcement in ad-hoc networks technical report stanford 
university 
 blake s black d carlson m davies e wang z 
and weiss w an architecture for differentiated service 
rfc 
 buchegger s and boudec j -y l performance analysis of 
the confidant protocol cooperation of nodes - fairness in 
dynamic ad-hoc networks in ieee acm symposium on mobile ad 
hoc networking and computing mobihoc 
 buchegger s and boudec j -y l coping with false 
accusations in misbehavior reputation systems for mobile ad-hoc 
networks in epfl technical report 
 buchegger s and boudec j -y l the effect of rumor 
spreading in reputation systems for mobile ad-hoc networks in 
wiopt modeling and optimization in mobile ad-hoc and 
wireless networks 
 buttyan l and hubaux j stimulating cooperation in 
self-organizing mobile ad-hoc networks acm kluwer journal on 
mobile networks and applications monet 
 caillaud b and hermalin b hidden action and incentives 
teaching notes u c berkeley 
 elkind e sahai a and steiglitz k frugality in path 
auctions 
 feigenbaum j papadimitriou c sami r and shenker 
s a bgp-based mechanism for lowest-cost routing in 
proceedings of the acm symposium on principles of distributed 
computing 
 feigenbaum j sami r and shenker s mechanism design 
for policy routing in yale university technical report 
 feigenbaum j and shenker s distributed algorithmic 
mechanism design recent results and future directions in 
proceedings of the international workshop on discrete algorithms 
and methods for mobile computing and communications 
 friedman e and shenker s learning and implementation on 
the internet in manuscript new brunswick rutgers university 
department of economics 
 holmstrom b moral hazard in teams bell journal of 
economics - 
 hu y perrig a and johnson d ariadne a secure 
on-demand routing protocol for ad-hoc networks in eighth 
annual international conference on mobile computing and 
networking mobicom pp - 
 hu y perrig a and johnson d sead secure efficient 
distance vector routing for mobile ad-hoc networks in th ieee 
workshop on mobile computing systems and applications wmcsa 
 
 jakobsson m hubaux j -p and buttyan l a 
micro-payment scheme encouraging collaboration in multi-hop 
cellular networks in financial cryptography 
 lakshminarayanan k stoica i and shenker s 
routing as a service in ucb technical report no 
ucb csd- - january 
 marti s giuli t j lai k and baker m mitigating 
routing misbehavior in mobile ad-hoc networks in proceedings of 
mobicom pp - 
 mass-colell a whinston m and green j 
microeconomic theory oxford university press 
 nisan n and ronen a algorithmic mechanism design in 
proceedings of the st symposium on theory of computing 
 sanzgiri k dahill b levine b shields c and 
belding-royer e a secure routing protocol for ad-hoc 
networks in international conference on network protocols icnp 
 
 shneidman j and parkes d c overcoming rational 
manipulation in mechanism implementation 
 strausz r moral hazard in sequential teams departmental 
working paper free university of berlin 
 teixeira r griffin t shaikh a and voelker g 
network sensitivity to hot-potato disruptions in proceedings of acm 
sigcomm september 
 teixeira r shaikh a griffin t and rexford 
j dynamics of hot-potato routing in ip networks in proceedings of 
acm sigmetrics june 
 yang x nira a new internet routing architecture in 
proceedings of sigcomm fdna august 
 zhong s chen j and yang y r sprite a simple 
cheat-proof credit-based system for mobile ad-hoc networks in 
 nd annual joint conference of the ieee computer and 
communications societies 
 zhu d gritter m and cheriton d feedback-based 
routing in proc hotnets-i 
 
